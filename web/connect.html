<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ButterflyFX Universal Connector - Connect to Everything</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-dot.green { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .status-dot.yellow { background: var(--warning); }
        .status-dot.red { background: var(--error); }
        .status-dot.gray { background: #64748b; }
        
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 15px 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--bg-input);
            color: var(--text);
            font-size: 1em;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .filter-btn {
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--bg-card);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            border-color: var(--primary);
            background: var(--primary);
        }
        
        .categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .category-pill {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }
        
        .category-pill:hover, .category-pill.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        
        .service-card {
            background: var(--bg-card);
            border-radius: 16px;
            border: 2px solid var(--border);
            padding: 25px;
            transition: all 0.3s;
            position: relative;
        }
        
        .service-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }
        
        .service-card.connected {
            border-color: var(--success);
        }
        
        .service-card.connected::before {
            content: '‚óè';
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--success);
            font-size: 12px;
        }
        
        .service-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .service-icon {
            font-size: 2.5em;
        }
        
        .service-info h3 {
            font-size: 1.1em;
            margin-bottom: 4px;
        }
        
        .service-badge {
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--success);
            color: white;
        }
        
        .service-badge.key-required {
            background: var(--warning);
        }
        
        .service-desc {
            color: var(--text-muted);
            font-size: 0.9em;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .service-fields {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .field-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .field-group label {
            font-size: 0.8em;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .field-group input {
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-input);
            color: var(--text);
            font-size: 0.95em;
        }
        
        .field-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .service-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }
        
        .btn-test {
            background: var(--bg-input);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn-test:hover {
            background: var(--border);
        }
        
        .btn-connect {
            background: var(--primary);
            color: white;
        }
        
        .btn-connect:hover {
            background: var(--primary-dark);
        }
        
        .btn-connect:disabled {
            background: #475569;
            cursor: not-allowed;
        }
        
        .btn-disconnect {
            background: var(--error);
            color: white;
        }
        
        .service-status {
            margin-top: 12px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            display: none;
        }
        
        .service-status.success {
            display: block;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .service-status.error {
            display: block;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }
        
        .service-status.testing {
            display: block;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .signup-link {
            display: block;
            margin-top: 10px;
            font-size: 0.8em;
            color: var(--primary);
            text-decoration: none;
        }
        
        .signup-link:hover {
            text-decoration: underline;
        }
        
        .no-key-badge {
            background: var(--success);
            color: white;
            font-size: 0.7em;
            padding: 3px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .services-grid { grid-template-columns: 1fr; }
            .search-bar { flex-direction: column; }
            .categories { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="/" style="color: white; text-decoration: none; opacity: 0.8;">‚Üê Back to Universal Hard Drive</a>
        <h1>ü¶ã Universal Connector</h1>
        <p>Connect to everything in one place. Add credentials. Test. Connect. Done.</p>
    </div>
    
    <div class="container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot green" id="uc-status"></span>
                <span>Universal Connector <span id="uc-version">v1.0</span></span>
            </div>
            <div class="status-item">
                <span id="connected-count">0</span> connected
            </div>
            <div class="status-item">
                <span id="available-count">0</span> available
            </div>
        </div>
        
        <!-- Search & Filter -->
        <div class="search-bar">
            <input type="text" id="search" placeholder="üîç Search services... (e.g., weather, stocks, email)">
            <button class="filter-btn" onclick="filterNoKey()">üÜì No Key Required</button>
            <button class="filter-btn" onclick="clearFilters()">Clear</button>
        </div>
        
        <!-- Categories -->
        <div class="categories" id="categories">
            <span class="category-pill active" data-category="all">All</span>
            <span class="category-pill" data-category="weather">üå§Ô∏è Weather</span>
            <span class="category-pill" data-category="finance">üí∞ Finance</span>
            <span class="category-pill" data-category="news">üì∞ News</span>
            <span class="category-pill" data-category="data">üìä Data</span>
            <span class="category-pill" data-category="ai">ü§ñ AI</span>
            <span class="category-pill" data-category="cloud">‚òÅÔ∏è Cloud</span>
            <span class="category-pill" data-category="email">üìß Email</span>
            <span class="category-pill" data-category="database">üóÑÔ∏è Database</span>
        </div>
        
        <!-- Services Grid -->
        <div class="services-grid" id="services-grid">
            <!-- Services loaded dynamically -->
        </div>
    </div>
    
    <script>
        // Service Registry - All major connections
        const SERVICES = [
            // ========== NO KEY REQUIRED ==========
            {
                id: 'wttr',
                name: 'wttr.in Weather',
                icon: 'üå§Ô∏è',
                category: 'weather',
                description: 'Weather data for any location. Just works - no signup needed.',
                noKeyRequired: true,
                fields: [
                    { name: 'location', label: 'Location', placeholder: 'London, NYC, Tokyo...', required: false }
                ]
            },
            {
                id: 'coingecko',
                name: 'CoinGecko',
                icon: 'ü¶é',
                category: 'finance',
                description: 'Crypto prices, market data, coin info. No API key needed.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'exchangerate',
                name: 'Exchange Rates',
                icon: 'üí±',
                category: 'finance',
                description: 'Live currency exchange rates. Free and open.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'wikipedia',
                name: 'Wikipedia',
                icon: 'üìö',
                category: 'data',
                description: 'Access Wikipedia articles, summaries, and search.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'hackernews',
                name: 'Hacker News',
                icon: 'üî∂',
                category: 'news',
                description: 'Top tech news from Y Combinator.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'jsonplaceholder',
                name: 'JSONPlaceholder',
                icon: 'üìã',
                category: 'data',
                description: 'Fake REST API for testing and prototyping.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'restcountries',
                name: 'REST Countries',
                icon: 'üó∫Ô∏è',
                category: 'data',
                description: 'Country data: population, languages, currencies.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'open-meteo',
                name: 'Open-Meteo',
                icon: 'üå°Ô∏è',
                category: 'weather',
                description: 'Free weather API with forecasts and historical data.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'numbersapi',
                name: 'Numbers API',
                icon: 'üî¢',
                category: 'data',
                description: 'Fun facts about numbers, dates, and years.',
                noKeyRequired: true,
                fields: []
            },
            {
                id: 'dictionaryapi',
                name: 'Free Dictionary',
                icon: 'üìñ',
                category: 'data',
                description: 'Word definitions, pronunciations, examples.',
                noKeyRequired: true,
                fields: []
            },
            
            // ========== API KEY REQUIRED ==========
            {
                id: 'openweather',
                name: 'OpenWeatherMap',
                icon: '‚õÖ',
                category: 'weather',
                description: 'Current weather, forecasts, historical data.',
                signupUrl: 'https://openweathermap.org/api',
                fields: [
                    { name: 'api_key', label: 'API Key', type: 'password', required: true }
                ]
            },
            {
                id: 'newsapi',
                name: 'NewsAPI',
                icon: 'üì∞',
                category: 'news',
                description: 'Breaking news from 80+ sources worldwide.',
                signupUrl: 'https://newsapi.org/register',
                fields: [
                    { name: 'api_key', label: 'API Key', type: 'password', required: true }
                ]
            },
            {
                id: 'alphavantage',
                name: 'Alpha Vantage',
                icon: 'üìà',
                category: 'finance',
                description: 'Stock quotes, forex, crypto, technical indicators.',
                signupUrl: 'https://www.alphavantage.co/support/#api-key',
                fields: [
                    { name: 'api_key', label: 'API Key', type: 'password', required: true }
                ]
            },
            {
                id: 'openai',
                name: 'OpenAI',
                icon: 'ü§ñ',
                category: 'ai',
                description: 'GPT-4, DALL-E, Whisper, embeddings.',
                signupUrl: 'https://platform.openai.com/api-keys',
                fields: [
                    { name: 'api_key', label: 'API Key', type: 'password', required: true }
                ]
            },
            {
                id: 'anthropic',
                name: 'Anthropic Claude',
                icon: 'ü¶ã',
                category: 'ai',
                description: 'Claude AI - Safe, helpful, honest.',
                signupUrl: 'https://console.anthropic.com/',
                fields: [
                    { name: 'api_key', label: 'API Key', type: 'password', required: true }
                ]
            },
            {
                id: 'github',
                name: 'GitHub',
                icon: 'üêô',
                category: 'data',
                description: 'Repositories, issues, PRs, gists.',
                signupUrl: 'https://github.com/settings/tokens',
                fields: [
                    { name: 'token', label: 'Personal Access Token', type: 'password', required: true }
                ]
            },
            {
                id: 'google-drive',
                name: 'Google Drive',
                icon: 'üìÅ',
                category: 'cloud',
                description: 'Access your Google Drive files.',
                signupUrl: 'https://console.cloud.google.com/',
                fields: [
                    { name: 'client_id', label: 'Client ID', required: true },
                    { name: 'client_secret', label: 'Client Secret', type: 'password', required: true }
                ]
            },
            {
                id: 'dropbox',
                name: 'Dropbox',
                icon: 'üì¶',
                category: 'cloud',
                description: 'Access your Dropbox files and folders.',
                signupUrl: 'https://www.dropbox.com/developers/apps',
                fields: [
                    { name: 'access_token', label: 'Access Token', type: 'password', required: true }
                ]
            },
            {
                id: 'gmail',
                name: 'Gmail',
                icon: 'üìß',
                category: 'email',
                description: 'Read and search your Gmail.',
                signupUrl: 'https://console.cloud.google.com/',
                fields: [
                    { name: 'client_id', label: 'Client ID', required: true },
                    { name: 'client_secret', label: 'Client Secret', type: 'password', required: true }
                ]
            },
            {
                id: 'postgres',
                name: 'PostgreSQL',
                icon: 'üêò',
                category: 'database',
                description: 'Connect to your PostgreSQL database.',
                fields: [
                    { name: 'host', label: 'Host', placeholder: 'localhost', required: true },
                    { name: 'port', label: 'Port', placeholder: '5432', required: true },
                    { name: 'database', label: 'Database', required: true },
                    { name: 'username', label: 'Username', required: true },
                    { name: 'password', label: 'Password', type: 'password', required: true }
                ]
            },
            {
                id: 'mysql',
                name: 'MySQL',
                icon: 'üê¨',
                category: 'database',
                description: 'Connect to your MySQL database.',
                fields: [
                    { name: 'host', label: 'Host', placeholder: 'localhost', required: true },
                    { name: 'port', label: 'Port', placeholder: '3306', required: true },
                    { name: 'database', label: 'Database', required: true },
                    { name: 'username', label: 'Username', required: true },
                    { name: 'password', label: 'Password', type: 'password', required: true }
                ]
            },
            {
                id: 'mongodb',
                name: 'MongoDB',
                icon: 'üçÉ',
                category: 'database',
                description: 'Connect to your MongoDB database.',
                fields: [
                    { name: 'connection_string', label: 'Connection String', type: 'password', placeholder: 'mongodb://...', required: true }
                ]
            },
            {
                id: 'aws-s3',
                name: 'AWS S3',
                icon: 'ü™£',
                category: 'cloud',
                description: 'Access your S3 buckets and objects.',
                signupUrl: 'https://aws.amazon.com/s3/',
                fields: [
                    { name: 'access_key', label: 'Access Key ID', required: true },
                    { name: 'secret_key', label: 'Secret Access Key', type: 'password', required: true },
                    { name: 'region', label: 'Region', placeholder: 'us-east-1', required: true }
                ]
            }
        ];
        
        // State
        let connectedServices = new Set();
        let currentFilter = 'all';
        let searchQuery = '';
        let showNoKeyOnly = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderServices();
            setupEventListeners();
            loadSavedConnections();
            updateStats();
        });
        
        function setupEventListeners() {
            // Search
            document.getElementById('search').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderServices();
            });
            
            // Categories
            document.querySelectorAll('.category-pill').forEach(pill => {
                pill.addEventListener('click', () => {
                    document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
                    pill.classList.add('active');
                    currentFilter = pill.dataset.category;
                    renderServices();
                });
            });
        }
        
        function filterNoKey() {
            showNoKeyOnly = !showNoKeyOnly;
            document.querySelector('.filter-btn').classList.toggle('active', showNoKeyOnly);
            renderServices();
        }
        
        function clearFilters() {
            showNoKeyOnly = false;
            searchQuery = '';
            currentFilter = 'all';
            document.getElementById('search').value = '';
            document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
            document.querySelector('[data-category="all"]').classList.add('active');
            document.querySelector('.filter-btn').classList.remove('active');
            renderServices();
        }
        
        function renderServices() {
            const grid = document.getElementById('services-grid');
            
            const filtered = SERVICES.filter(svc => {
                if (currentFilter !== 'all' && svc.category !== currentFilter) return false;
                if (showNoKeyOnly && !svc.noKeyRequired) return false;
                if (searchQuery && !svc.name.toLowerCase().includes(searchQuery) && 
                    !svc.description.toLowerCase().includes(searchQuery)) return false;
                return true;
            });
            
            grid.innerHTML = filtered.map(svc => renderServiceCard(svc)).join('');
            updateStats();
        }
        
        function renderServiceCard(svc) {
            const isConnected = connectedServices.has(svc.id);
            const fieldsHtml = svc.fields.map(f => `
                <div class="field-group">
                    <label>${f.label}${f.required ? ' *' : ''}</label>
                    <input type="${f.type || 'text'}" 
                           id="${svc.id}-${f.name}" 
                           placeholder="${f.placeholder || ''}"
                           ${isConnected ? 'disabled' : ''}>
                </div>
            `).join('');
            
            return `
                <div class="service-card ${isConnected ? 'connected' : ''}" data-service="${svc.id}">
                    <div class="service-header">
                        <span class="service-icon">${svc.icon}</span>
                        <div class="service-info">
                            <h3>${svc.name}
                                ${svc.noKeyRequired ? '<span class="no-key-badge">NO KEY</span>' : ''}
                            </h3>
                            <span class="service-badge ${svc.noKeyRequired ? '' : 'key-required'}">
                                ${svc.noKeyRequired ? 'Ready to use' : 'API key required'}
                            </span>
                        </div>
                    </div>
                    <p class="service-desc">${svc.description}</p>
                    
                    ${fieldsHtml ? `<div class="service-fields">${fieldsHtml}</div>` : ''}
                    
                    ${svc.signupUrl ? `<a href="${svc.signupUrl}" target="_blank" class="signup-link">üîë Get API key ‚Üí</a>` : ''}
                    
                    <div class="service-actions">
                        <button class="btn btn-test" onclick="testConnection('${svc.id}')">
                            üîç Test
                        </button>
                        ${isConnected ? 
                            `<button class="btn btn-disconnect" onclick="disconnect('${svc.id}')">Disconnect</button>` :
                            `<button class="btn btn-connect" onclick="connect('${svc.id}')" ${svc.fields.some(f => f.required) ? `id="btn-connect-${svc.id}"` : ''}>
                                ‚ö° Connect
                            </button>`
                        }
                    </div>
                    
                    <div class="service-status" id="status-${svc.id}"></div>
                </div>
            `;
        }
        
        function getCredentials(serviceId) {
            const svc = SERVICES.find(s => s.id === serviceId);
            if (!svc) return {};
            
            const creds = {};
            svc.fields.forEach(f => {
                const input = document.getElementById(`${serviceId}-${f.name}`);
                if (input) creds[f.name] = input.value;
            });
            return creds;
        }
        
        function setStatus(serviceId, type, message) {
            const statusEl = document.getElementById(`status-${serviceId}`);
            if (statusEl) {
                statusEl.className = `service-status ${type}`;
                statusEl.textContent = message;
            }
        }
        
        async function testConnection(serviceId) {
            const svc = SERVICES.find(s => s.id === serviceId);
            setStatus(serviceId, 'testing', '‚è≥ Testing connection...');
            
            try {
                const credentials = getCredentials(serviceId);
                
                const response = await fetch('/api/uc/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ service_id: serviceId, credentials })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    setStatus(serviceId, 'success', '‚úÖ Connection successful!');
                } else {
                    setStatus(serviceId, 'error', `‚ùå ${result.error || 'Connection failed'}`);
                }
            } catch (error) {
                // Try direct test for no-key services
                if (svc.noKeyRequired) {
                    setStatus(serviceId, 'success', '‚úÖ Service available (no key needed)');
                } else {
                    setStatus(serviceId, 'error', `‚ùå ${error.message}`);
                }
            }
        }
        
        async function connect(serviceId) {
            const svc = SERVICES.find(s => s.id === serviceId);
            setStatus(serviceId, 'testing', '‚è≥ Connecting...');
            
            try {
                const credentials = getCredentials(serviceId);
                
                const response = await fetch('/api/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        provider: serviceId, 
                        credentials,
                        name: svc.name
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    connectedServices.add(serviceId);
                    saveConnections();
                    setStatus(serviceId, 'success', `‚úÖ Connected as ${result.drive_letter || 'drive'}:`);
                    setTimeout(() => renderServices(), 1000);
                } else {
                    setStatus(serviceId, 'error', `‚ùå ${result.error || 'Connection failed'}`);
                }
            } catch (error) {
                // For demo - mark as connected locally
                if (svc.noKeyRequired || !svc.fields.some(f => f.required)) {
                    connectedServices.add(serviceId);
                    saveConnections();
                    setStatus(serviceId, 'success', '‚úÖ Connected!');
                    setTimeout(() => renderServices(), 1000);
                } else {
                    setStatus(serviceId, 'error', `‚ùå ${error.message}`);
                }
            }
        }
        
        function disconnect(serviceId) {
            connectedServices.delete(serviceId);
            saveConnections();
            setStatus(serviceId, '', '');
            renderServices();
        }
        
        function saveConnections() {
            localStorage.setItem('uhd_connections', JSON.stringify([...connectedServices]));
        }
        
        function loadSavedConnections() {
            try {
                const saved = localStorage.getItem('uhd_connections');
                if (saved) {
                    connectedServices = new Set(JSON.parse(saved));
                }
            } catch (e) {}
        }
        
        function updateStats() {
            document.getElementById('connected-count').textContent = connectedServices.size;
            document.getElementById('available-count').textContent = SERVICES.length;
        }
    </script>
</body>
</html>
