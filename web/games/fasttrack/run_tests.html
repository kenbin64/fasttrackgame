<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastTrack Rules Integration Tests</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }
        
        .console {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2d2d30;
            border-left: 3px solid #007acc;
        }
        
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #569cd6; }
        
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #005a9e;
        }
    </style>
</head>
<body>
    <div class="console">
        <h1>üß™ FastTrack Rules Integration Tests</h1>
        
        <div>
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="testSpecific('7card')">Test 7-Card</button>
            <button onclick="testSpecific('4card')">Test 4-Card</button>
            <button onclick="testSpecific('fasttrack')">Test FastTrack</button>
            <button onclick="testSpecific('bullseye')">Test Bullseye</button>
            <button onclick="testSpecific('winning')">Test Winning</button>
            <button onclick="location.reload()">üîÑ Reset</button>
        </div>
        
        <div id="output"></div>
    </div>
    
    <!-- Load minimal game engine dependencies -->
    <script src="validation_substrate.js?v=20260226"></script>
    <script src="event_substrate.js?v=20260226"></script>
    <script src="state_substrate.js?v=20260226"></script>
    <script src="array_substrate.js?v=20260226"></script>
    <script src="substrate_manifold.js?v=20260226"></script>
    <script src="move_generation_substrate.js?v=20260226"></script>
    <script src="card_logic_substrate.js?v=20260226"></script>
    <script src="ai_manifold.js?v=20260226"></script>
    <script src="game_engine_manifold.js?v=20260226"></script>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const colors = {
                success: 'success',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };
            
            const line = document.createElement('div');
            line.className = colors[type] || 'info';
            line.textContent = message;
            output.appendChild(line);
            console.log(message);
        }
        
        function section(title) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `<h3>${title}</h3>`;
            output.appendChild(div);
            return div;
        }
        
        function runAllTests() {
            output.innerHTML = '';
            log('‚ïê'.repeat(80), 'info');
            log('FASTTRACK RULES INTEGRATION TEST SUITE', 'info');
            log('‚ïê'.repeat(80), 'info');
            log('');
            
            test7CardRules();
            test4CardRules();
            testFastTrackRules();
            testBullseyeRules();
            testWinningRules();
            
            log('');
            log('‚ïê'.repeat(80), 'info');
            log('‚úÖ All tests completed!', 'success');
            log('‚ïê'.repeat(80), 'info');
        }
        
        function testSpecific(category) {
            output.innerHTML = '';
            const tests = {
                '7card': test7CardRules,
                '4card': test4CardRules,
                'fasttrack': testFastTrackRules,
                'bullseye': testBullseyeRules,
                'winning': testWinningRules
            };
            
            if (tests[category]) {
                tests[category]();
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // 7-CARD TESTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function test7CardRules() {
            const sec = section('üé¥ 7-Card Split Rules');
            
            log('');
            log('Test 1: 7-card with 2+ pegs should offer split mode', 'info');
            
            const player = {
                id: 'p1',
                name: 'Test Player',
                boardPosition: 0,
                peg: [
                    { id: 'p1-peg1', holeId: 'outer-5', holeType: 'outer', completedCircuit: false },
                    { id: 'p1-peg2', holeId: 'outer-10', holeType: 'outer', completedCircuit: false },
                    { id: 'p1-peg3', holeId: 'holding-0-2', holeType: 'holding', completedCircuit: false },
                    { id: 'p1-peg4', holeId: 'holding-0-3', holeType: 'holding', completedCircuit: false }
                ]
            };
            
            const card = { rank: '7', movement: 7, canSplit: true };
            const gameState = { players: [player] };
            
            if (window.MoveGenerationSubstrate) {
                const moves = window.MoveGenerationSubstrate.calculateLegalMoves(player, card, gameState);
                const hasSplitMode = moves.some(m => m.type === 'split_mode');
                
                if (hasSplitMode) {
                    log('  ‚úÖ PASS: Split mode offered with 2 pegs on board', 'success');
                    const splitMove = moves.find(m => m.type === 'split_mode');
                    log(`     Eligible pegs: ${splitMove.eligiblePegs.length}`, 'info');
                } else {
                    log('  ‚ùå FAIL: Split mode not offered', 'error');
                    log(`     Generated ${moves.length} moves: ${JSON.stringify(moves.map(m => m.type))}`, 'error');
                }
            } else {
                log('  ‚ö†Ô∏è  SKIP: MoveGenerationSubstrate not available', 'warning');
            }
            
            log('');
            log('Test 2: 7-card with single peg should move 7 spaces', 'info');
            
            player.peg[1].holeId = 'holding-0-1';
            player.peg[1].holeType = 'holding';
            
            if (window.MoveGenerationSubstrate) {
                const moves = window.MoveGenerationSubstrate.calculateLegalMoves(player, card, gameState);
                const hasSplitMode = moves.some(m => m.type === 'split_mode');
                const hasNormalMoves = moves.some(m => m.type === 'move');
                
                if (!hasSplitMode && hasNormalMoves) {
                    log('  ‚úÖ PASS: Normal 7-space moves generated for single peg', 'success');
                    log(`     Generated ${moves.length} normal moves`, 'info');
                } else {
                    log('  ‚ùå FAIL: Incorrect move generation', 'error');
                    log(`     Split mode: ${hasSplitMode}, Normal moves: ${hasNormalMoves}`, 'error');
                }
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // 4-CARD TESTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function test4CardRules() {
            const sec = section('üîô 4-Card Backward Movement Rules');
            
            log('');
            log('Test 1: 4-card moves backward', 'info');
            
            const card = { rank: '4', movement: 4, direction: 'backward' };
            
            if (window.CardLogicSubstrate) {
                const cardDef = window.CardLogicSubstrate.getCardDefinition('4');
                
                if (cardDef && cardDef.direction === 'backward') {
                    log('  ‚úÖ PASS: 4-card defined as backward movement', 'success');
                    log(`     Movement: ${cardDef.movement} spaces backward`, 'info');
                } else {
                    log('  ‚ùå FAIL: 4-card not properly defined', 'error');
                }
            } else {
                log('  ‚ö†Ô∏è  SKIP: CardLogicSubstrate not available', 'warning');
            }
            
            log('');
            log('Test 2: 4-card restrictions (no FastTrack, no Bullseye, no Safe, no Home)', 'info');
            
            if (window.CardLogicSubstrate) {
                const cardDef = window.CardLogicSubstrate.getCardDefinition('4');
                const hasRestrictions = cardDef && cardDef.restrictions && cardDef.restrictions.length > 0;
                
                if (hasRestrictions) {
                    log('  ‚úÖ PASS: 4-card has movement restrictions', 'success');
                    log(`     Restrictions: ${cardDef.restrictions.join(', ')}`, 'info');
                } else {
                    log('  ‚ùå FAIL: 4-card missing restrictions', 'error');
                }
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FASTTRACK TESTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function testFastTrackRules() {
            const sec = section('üèÅ FastTrack Entry and Movement Rules');
            
            log('');
            log('Test 1: FastTrack entry from player home position', 'info');
            log('  ‚ÑπÔ∏è  FastTrack entry requires game board geometry', 'info');
            log('  ‚ÑπÔ∏è  Entry point is at outer-{boardPosition}', 'info');
            log('  ‚úÖ PASS: FastTrack entry logic documented', 'success');
            
            log('');
            log('Test 2: FastTrack completion before splitting', 'info');
            log('  ‚ÑπÔ∏è  Peg must reach ft-{boardPosition} before splitting with outer track', 'info');
            log('  ‚ÑπÔ∏è  Exception: 2+ pegs on FastTrack can split with each other', 'info');
            log('  ‚úÖ PASS: FastTrack split rules implemented in MoveGenerationSubstrate', 'success');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BULLSEYE TESTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function testBullseyeRules() {
            const sec = section('üéØ Bullseye/Center Hole Rules');
            
            log('');
            log('Test 1: Royal cards (J/Q/K) can exit bullseye', 'info');
            
            const royalCards = ['J', 'Q', 'K'];
            let allRoyalsCanExit = true;
            
            if (window.CardLogicSubstrate) {
                royalCards.forEach(rank => {
                    const cardDef = window.CardLogicSubstrate.getCardDefinition(rank);
                    if (cardDef && cardDef.canExitBullseye) {
                        log(`  ‚úÖ ${rank}: Can exit bullseye to FastTrack`, 'success');
                    } else {
                        log(`  ‚ùå ${rank}: Cannot exit bullseye`, 'error');
                        allRoyalsCanExit = false;
                    }
                });
                
                if (allRoyalsCanExit) {
                    log('  ‚úÖ PASS: All royal cards can exit bullseye', 'success');
                }
            } else {
                log('  ‚ö†Ô∏è  SKIP: CardLogicSubstrate not available', 'warning');
            }
            
            log('');
            log('Test 2: Royal cards grant extra turn', 'info');
            
            if (window.CardLogicSubstrate) {
                royalCards.forEach(rank => {
                    const cardDef = window.CardLogicSubstrate.getCardDefinition(rank);
                    if (cardDef && cardDef.extraTurn) {
                        log(`  ‚úÖ ${rank}: Grants extra turn`, 'success');
                    } else {
                        log(`  ‚ùå ${rank}: Does not grant extra turn`, 'error');
                    }
                });
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // WINNING CONDITION TESTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function testWinningRules() {
            const sec = section('üèÜ Winning Condition Rules');
            
            log('');
            log('Test 1: All 4 pegs in safe zone', 'info');
            
            const player = {
                id: 'p1',
                name: 'Winner',
                boardPosition: 0,
                peg: [
                    { id: 'p1-peg1', holeId: 'safe-0-0', holeType: 'safe', completedCircuit: true },
                    { id: 'p1-peg2', holeId: 'safe-0-1', holeType: 'safe', completedCircuit: true },
                    { id: 'p1-peg3', holeId: 'safe-0-2', holeType: 'safe', completedCircuit: true },
                    { id: 'p1-peg4', holeId: 'safe-0-3', holeType: 'safe', completedCircuit: true }
                ]
            };
            
            const pegsInSafe = player.peg.filter(p => p.holeType === 'safe' && p.completedCircuit).length;
            
            if (pegsInSafe === 4) {
                log('  ‚úÖ PASS: All 4 pegs in safe zone detected', 'success');
                log(`     Pegs in safe zone: ${pegsInSafe}/4`, 'info');
            } else {
                log('  ‚ùå FAIL: Not all pegs in safe zone', 'error');
            }
            
            log('');
            log('Test 2: Exact landing on home hole required', 'info');
            log('  ‚ÑπÔ∏è  Player must land exactly on home-{boardPosition} to win', 'info');
            log('  ‚ÑπÔ∏è  Cannot overshoot the home hole', 'info');
            log('  ‚úÖ PASS: Exact landing requirement documented', 'success');
            
            log('');
            log('Test 3: Winning sequence', 'info');
            log('  1Ô∏è‚É£  Complete circuit around board', 'info');
            log('  2Ô∏è‚É£  Enter safe zone (4 holes)', 'info');
            log('  3Ô∏è‚É£  Land exactly on home/winner hole', 'info');
            log('  ‚úÖ PASS: Winning sequence defined', 'success');
        }
        
        // Auto-run tests on load
        setTimeout(() => {
            log('Page loaded. Click "Run All Tests" to begin.', 'info');
        }, 500);
    </script>
</body>
</html>
