<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastTrack Sound Effects Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        h1 { color: #f1c40f; margin-bottom: 10px; }
        h2 { color: #9b59b6; margin-top: 30px; }
        .tagline { color: #888; font-size: 12px; margin-bottom: 30px; }
        .section {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        button {
            padding: 15px 20px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        button:hover { transform: scale(1.05); }
        button:active { transform: scale(0.98); }
        
        .sfx-btn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .theme-btn { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .music-btn { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .test-btn { background: linear-gradient(135deg, #27ae60, #1e8449); color: white; }
        
        .emoji { font-size: 24px; }
        .label { font-size: 12px; opacity: 0.9; }
        
        #log {
            background: #0a0a15;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.6;
        }
        .log-entry { margin: 2px 0; }
        .log-success { color: #2ecc71; }
        .log-info { color: #3498db; }
        .log-warn { color: #f39c12; }
        .log-error { color: #e74c3c; }
        
        #status {
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 13px;
        }
        .status-ok { border-left: 3px solid #2ecc71; }
        .status-error { border-left: 3px solid #e74c3c; }
        
        select {
            padding: 10px;
            font-size: 14px;
            border-radius: 6px;
            background: #2a2a3e;
            color: white;
            border: 1px solid #555;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <h1>üîä FastTrack Sound Effects Test</h1>
    <div class="tagline">Powered by <strong style="color:#f1c40f">ButterflyFX</strong> ‚Ä¢ Dimensional Programming</div>
    
    <div id="status" class="status-ok">
        Click any button to activate audio context (required by browsers)
    </div>
    
    <div class="section">
        <h2>üéöÔ∏è Theme Selection</h2>
        <p style="color:#aaa; font-size:13px;">Different themes have different sound character</p>
        <select id="themeSelect" onchange="changeTheme(this.value)">
            <option value="DEFAULT">üèüÔ∏è Classic Arena (DEFAULT)</option>
            <option value="SPACE_ACE">üöÄ Space Ace</option>
            <option value="UNDERSEA">üåä Under the Sea</option>
            <option value="ROMAN_COLISEUM">‚öîÔ∏è Roman Coliseum</option>
            <option value="FIBONACCI">üêö Golden Spiral (Fibonacci)</option>
        </select>
    </div>
    
    <div class="section">
        <h2>üéÆ Game Sound Effects</h2>
        <div class="btn-grid">
            <button class="sfx-btn" onclick="testSound('step')">
                <span class="emoji">üë£</span>
                <span class="label">Step (Traversal)</span>
            </button>
            <button class="sfx-btn" onclick="testSound('arrive')">
                <span class="emoji">üéØ</span>
                <span class="label">Arrive</span>
            </button>
            <button class="sfx-btn" onclick="testSound('fasttrack')">
                <span class="emoji">üöÄ</span>
                <span class="label">FastTrack Entry</span>
            </button>
            <button class="sfx-btn" onclick="testSound('bullseye')">
                <span class="emoji">üéØ</span>
                <span class="label">Bullseye</span>
            </button>
            <button class="sfx-btn" onclick="testSound('safezone')">
                <span class="emoji">üè†</span>
                <span class="label">Safe Zone</span>
            </button>
            <button class="sfx-btn" onclick="testSound('boot')">
                <span class="emoji">üí•</span>
                <span class="label">Boot Opponent</span>
            </button>
            <button class="sfx-btn" onclick="testSound('victory')">
                <span class="emoji">üèÜ</span>
                <span class="label">Victory!</span>
            </button>
            <button class="sfx-btn" onclick="testSound('drawCard')">
                <span class="emoji">üÉè</span>
                <span class="label">Draw Card</span>
            </button>
            <button class="sfx-btn" onclick="testSound('extraTurn')">
                <span class="emoji">6Ô∏è‚É£</span>
                <span class="label">Extra Turn</span>
            </button>
            <button class="sfx-btn" onclick="testSound('pegEntry')">
                <span class="emoji">‚ûï</span>
                <span class="label">Peg Entry</span>
            </button>
            <button class="sfx-btn" onclick="testSound('royalExit')">
                <span class="emoji">üëë</span>
                <span class="label">Royal Exit</span>
            </button>
        </div>
    </div>
    
    <div class="section">
        <h2>üéµ Music Substrate Tests</h2>
        <div class="btn-grid">
            <button class="music-btn" onclick="testMusicPing()">
                <span class="emoji">üìç</span>
                <span class="label">Ping (50, 50)</span>
            </button>
            <button class="music-btn" onclick="testMusicSoundCheck()">
                <span class="emoji">üîî</span>
                <span class="label">Sound Check Arpeggio</span>
            </button>
            <button class="music-btn" onclick="testMusicChord()">
                <span class="emoji">üéπ</span>
                <span class="label">Chord (5 notes)</span>
            </button>
            <button class="music-btn" onclick="testMusicSequence()">
                <span class="emoji">üé∂</span>
                <span class="label">Sequence (melody)</span>
            </button>
        </div>
    </div>
    
    <div class="section">
        <h2>üß™ Traversal Simulation</h2>
        <p style="color:#aaa; font-size:13px;">Simulates peg moving through multiple holes</p>
        <div class="btn-grid">
            <button class="test-btn" onclick="simulateTraversal(3)">
                <span class="emoji">3Ô∏è‚É£</span>
                <span class="label">3-Step Move</span>
            </button>
            <button class="test-btn" onclick="simulateTraversal(6)">
                <span class="emoji">6Ô∏è‚É£</span>
                <span class="label">6-Step Move</span>
            </button>
            <button class="test-btn" onclick="simulateTraversal(12)">
                <span class="emoji">üîü</span>
                <span class="label">12-Step Move</span>
            </button>
        </div>
    </div>
    
    <div class="section">
        <h2>üìã Console Output</h2>
        <div id="log"></div>
    </div>
    
    <!-- Load the audio scripts -->
    <script src="natural_lens.js?v=1"></script>
    <script src="music_substrate.js?v=1"></script>
    <script src="game_sfx.js?v=1"></script>
    
    <script>
        const logEl = document.getElementById('log');
        const statusEl = document.getElementById('status');
        
        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function updateStatus(message, ok = true) {
            statusEl.textContent = message;
            statusEl.className = ok ? 'status-ok' : 'status-error';
        }
        
        // Check if scripts loaded
        window.addEventListener('load', () => {
            log('Page loaded, checking audio systems...', 'info');
            
            if (typeof GameSFX !== 'undefined') {
                log('‚úì GameSFX loaded (v' + GameSFX.version + ')', 'success');
            } else {
                log('‚úó GameSFX NOT loaded!', 'error');
            }
            
            if (typeof MusicSubstrate !== 'undefined') {
                log('‚úì MusicSubstrate loaded (v' + MusicSubstrate.version + ')', 'success');
            } else {
                log('‚úó MusicSubstrate NOT loaded!', 'error');
            }
            
            if (typeof NaturalLens !== 'undefined') {
                log('‚úì NaturalLens loaded', 'success');
            } else {
                log('‚ö† NaturalLens not loaded (fallback mode)', 'warn');
            }
            
            updateStatus('Audio systems ready. Click a button to test!');
        });
        
        function changeTheme(themeName) {
            log(`Changing theme to: ${themeName}`, 'info');
            
            if (typeof GameSFX !== 'undefined') {
                GameSFX.setTheme(themeName);
                log(`GameSFX theme set to: ${themeName}`, 'success');
            }
            
            if (typeof MusicSubstrate !== 'undefined') {
                MusicSubstrate.currentTheme = themeName;
                log(`MusicSubstrate theme set to: ${themeName}`, 'success');
            }
        }
        
        function testSound(eventName) {
            log(`Playing SFX: ${eventName}`, 'info');
            
            if (typeof GameSFX === 'undefined') {
                log('Error: GameSFX not loaded!', 'error');
                updateStatus('GameSFX not loaded!', false);
                return;
            }
            
            // Activate and play
            const activated = GameSFX.activate();
            if (!activated) {
                log('Failed to activate audio context', 'error');
                updateStatus('Audio context failed to activate', false);
                return;
            }
            
            log(`Audio context state: ${GameSFX.audioContext?.state}`, 'info');
            
            if (eventName === 'step') {
                // Play single step (middle of sequence)
                GameSFX.playStep(2, 5);
            } else {
                GameSFX.play(eventName);
            }
            
            updateStatus(`Playing: ${eventName}`, true);
        }
        
        function testMusicPing() {
            log('Testing MusicSubstrate.ping(50, 50)', 'info');
            
            if (typeof MusicSubstrate === 'undefined') {
                log('Error: MusicSubstrate not loaded!', 'error');
                return;
            }
            
            MusicSubstrate.activate();
            const result = MusicSubstrate.ping(50, 50, { duration: 0.5, volume: 0.3 });
            log(`Ping result: ${JSON.stringify(result)}`, 'success');
        }
        
        function testMusicSoundCheck() {
            log('Testing MusicSubstrate.pingSoundCheck()', 'info');
            
            if (typeof MusicSubstrate === 'undefined') {
                log('Error: MusicSubstrate not loaded!', 'error');
                return;
            }
            
            MusicSubstrate.pingSoundCheck();
        }
        
        function testMusicChord() {
            log('Testing MusicSubstrate.pingChord()', 'info');
            
            if (typeof MusicSubstrate === 'undefined') {
                log('Error: MusicSubstrate not loaded!', 'error');
                return;
            }
            
            const points = [
                { x: 0, y: 50 },
                { x: 25, y: 50 },
                { x: 50, y: 50 },
                { x: 75, y: 50 },
                { x: 100, y: 50 }
            ];
            MusicSubstrate.pingChord(points, { duration: 0.6, volume: 0.2 });
        }
        
        function testMusicSequence() {
            log('Testing MusicSubstrate.pingSequence()', 'info');
            
            if (typeof MusicSubstrate === 'undefined') {
                log('Error: MusicSubstrate not loaded!', 'error');
                return;
            }
            
            const melody = [
                { x: 0, y: 50 },
                { x: 20, y: 60 },
                { x: 40, y: 70 },
                { x: 60, y: 60 },
                { x: 80, y: 50 },
                { x: 100, y: 40 }
            ];
            MusicSubstrate.pingSequence(melody, 180, { duration: 0.25, volume: 0.25 });
        }
        
        function simulateTraversal(steps) {
            log(`Simulating ${steps}-step peg traversal...`, 'info');
            
            if (typeof GameSFX === 'undefined') {
                log('Error: GameSFX not loaded!', 'error');
                return;
            }
            
            GameSFX.activate();
            
            // Simulate hop timing (200ms per hop like in the game)
            for (let i = 0; i < steps; i++) {
                setTimeout(() => {
                    GameSFX.playStep(i, steps);
                    log(`  Step ${i + 1}/${steps}`, 'info');
                }, i * 200);
            }
            
            // Play arrival sound at end
            setTimeout(() => {
                GameSFX.playArrive();
                log(`  ARRIVED!`, 'success');
            }, steps * 200 + 50);
        }
    </script>
</body>
</html>
